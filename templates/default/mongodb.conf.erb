# THIS FILE HAS BEEN GENERATED BY CHEF
# ANY MANUAL MODIFICATIONS WILL BE OVERWRITTEN

# Where to store the data.

# Note: if you run mongodb as a non-root user (recommended) you may
# need to create and set permissions for this directory manually,
# e.g., if the parent directory isn't mutable by the mongodb user.

<%
	config = node[:mongodb][@server_type]

	[
		:dbpath,
		:logpath, # where to log
		:bind_ip,
		:port,
		:cpu, # Enables periodic logging of CPU utilization and I/O wait
		:verbose, # Verbose logging output.
		:objcheck, # Inspect all client data for validity on receipt (useful for developing drivers)
		:quota, # Enable db quota management

		# Set oplogging level where n is
		#   0=off (default)
		#   1=W
		#   2=R
		#   3=both
		#   7=W+some reads
		:diaglog,
		:nocursors, # Diagnostic/debugging option
		:nohints, # Igonore query hints
		:nohttpinterface, # Disable the HTTP interface (Defaults to localhost:27018).
		:noscripting, # Turns off server-side scripting.  This will result in greatly limited functionality
		:notablescan, # Turns off table scans.  Any query that would do a table scan fails.
		:noprealloc, # Disable data file preallocation.
		:nssize, # Specify .ns file size for new databases.
		:replSet, # replica set name
		:auth, # authentication
	].each do |option|
		if config[option]
%>
<%= option %> = <%= config[option] %>
<%
		end
	end
%>

logappend = true

<%
	if config[:mms]
		[
			'mms-token', # Accout token for Mongo monitoring server.
			'mms-name', # Server name for Mongo monitoring server.
			'mms-interval' # Ping interval for Mongo monitoring server.
		].each do |option|
			if config[option]
%>
<%= option %> = <%= config[option] %>
<%
			end
		end
	end
%>

<% if config[:replication] %>
  # Replication Options
  # in replicated mongo databases, specify here whether this is a slave or master
  <% if @node[:mongodb][:slave] %>
  slave = <%= @node[:mongodb][:slave] %>
  source = <%= @node[:mongodb][:slave_source] %>
  # Slave only: specify a single database to replicate
  only = <%= @node[:mongodb][:slave_only] %>
  <% end %>

  <% if @node[:mongodb][:master] %>
  master = <%= @node[:mongodb][:master] %>
  source = <%= @node[:mongodb][:master_source] %>
  <% end %>

  # Automatically resync if slave data is stale
  <%= p "autoresync" if @node[:mongodb][:autoresync] %>
  # Custom size for replication operation log.
  oplogSize = <%= @node[:mongodb][:oplogsize] %>
  # Size limit for in-memory storage of op ids.
  opIdMem = <%= @node[:mongodb][:opidmem] * 1024 * 1024 %>
<% end %>
